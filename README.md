# 나스닥 레버리지 투자 백테스팅 시뮬레이터

"나스닥 레버리지 ETF(QLD, TQQQ)를 10년 전부터 매달 100만원씩 꾸준히 적립식 매수 했다면 **지금 얼마가 됐을까?**"

위와 같이 과거의 데이터를 사용하여 특정 투자 전략을 검증하는 방법을 '**백테스팅(backtesting)**'이라고 합니다.

물론 백테스팅이 가능한 시뮬레이터는 다양한 사이트에 이미 구현이 되어있습니다.

하지만 QLD와 TQQQ처럼 **2010년 이후의 데이터만이 존재하는 ETF 상품**의 경우 2008년 금융 위기나 닷컴버블과 같은 **큰 시장 변동성을 겪는다면 원금이 얼마나 녹을지**, 또 **이를 감수하고도 투자하는 전략을 선택할 수 있을지**를 결정하기 위한 검증이 어렵습니다.

<br>

하지만 이 시뮬레이터는 **가능합니다!**

이 백테스팅 시뮬레이터는 **1971년 2월** 최초로 상장된 나스닥 지수와 모든 날짜의 상승/하락 데이터를 이용해 **레버리지 배율이 반영된 일일 주가들을 직접 계산합니다.**

이를 통해 **2010년보다 훨씬 이전의 상황에 나스닥 레버리지 ETF가 존재했을 경우 이익 또는 손실이 얼마나 발생했을지**를 계산할 수 있습니다.

- **2000년부터 QLD(나스닥 2배)를 지금까지 매달 적립식 매수를 했다면?**
- **2007년부터 2009년까지 SQQQ(나스닥 -3배)를 매달 적립식 매수를 했다면?**

위 질문에 대한 답을 단 5초만에 구하고, 차트로 확인해 볼 수 있습니다!

## 주요 기능

- 1971년 2월~현재 중 자유롭게 기간을 설정하여 나스닥 레버리지 ETF 백테스팅 가능
- QLD, TQQQ, SQQQ와 같은 2배, 3배, -3배 레버리지 투자 전략 시뮬레이션
- 현금 보유(0배)나 자유로운 소수점 레버리지(예: 2.25배) 설정하여 확인 가능
- 매월 일정 금액 적립식 매수 시뮬레이션: 자유로운 매수 금액(예: 매달 30만원) 설정 가능
- 과거 시장 변동(닷컴버블, 서브프라임 모기지 사태 등) 구간에서도 투자 전략이 잘 작동하는지 확인 가능
- 현금 보유와 레버리지 ETF에 투자했을 때의 비교 등

## 실행 방법

**실행 방법은 매우 간단합니다. 하나만 하면 됩니다.**
**오직 `nasdaq_investment_simulation.py` 파일만 실행하면 됩니다:**

```bash
python nasdaq_investment_simulation.py
```

**또는 파이썬을 실행할 수 있는 프로그램이 있으면 자유롭게 `nasdaq_investment_simulation.py`를 실행하면 됩니다.**

필요한 패키지가 설치되어 있지 않을 경우, 아래 명령어를 사용하여 설치하세요:

```bash
pip install pandas matplotlib numpy xlsxwriter
```

### 오류 해결

프로젝트 실행 시 오류가 발생한다면, 아래 파일들을 참고하세요:

- `nasdaq_data_collection.py`: 데이터 파일이 없을 경우 이 파일을 실행하여 데이터를 수집합니다. (`nasdaq_daily_returns.xlsx` 파일이 `output` 폴더에 있어야 합니다)

## 출력 결과와 실행 예시

프로그램이 실행되면 시뮬레이션 결과가 출력됩니다. 두 레버리지 비율에 따른 최종 자산 금액과 수익률을 확인할 수 있습니다.

예를 들어 닷컴 버블과 서브프라임 모기지 사태를 모두 포함하는 **1997년부터 2010년까지 QLD(나스닥 2x 레버리지)와 SQQQ(나스닥 -3배 레버리지)를 매달 100만원씩 매수**했다고 가정하고 테스트를 해 볼까요?

```bash
===== 나스닥 적립식 매수 시뮬레이션 =====
차트를 확인할 첫 번째 레버리지 비율을 입력하세요 (예: 2.25): 2  
차트를 확인할 두 번째 레버리지 비율을 입력하세요 (예: -3): -3
적립식 매수를 시작할 연과 월을 입력하세요 (예: 1972 2): 1997 1
적립실 매수를 종료할 연과 월을 입력하세요 (예: 2024 9): 2010 12
매월 적립식 매수할 금액을 입력하세요 (단위: 만원): 100
========================================
- 현금 보유했을 경우 최종 금액: 167,000,000원
========================================
- 2.0배 레버리지를 매달 100만원씩 적립식 매수했을 경우: 
  - 최종 금액: 192,839,983원
  - 최종 수익률: 14.79% (1.15배)
========================================
- -3.0배 레버리지를 매달 100만원씩 적립식 매수했을 경우:
  - 최종 금액: 17,165,399원
  - 최종 수익률: -89.78% (0.10배)
========================================
시뮬레이션이 완료되었습니다.
나스닥 지수 비교 차트 이미지가 '/output/nasdaq_index_comparison.png'로 저장되었습니다.
총 투자 금액과 누적 총 자산 비교 차트 이미지가 '/output/investment_vs_asset_value.png'로 저장되었
습니다.
자세한 데이터는 './output/investment_simulation.xlsx'에서 확인하세요.
```

- 위와 같이 두 레버리지 ETF를 각각 적립식 매수했을 때의 총 자산과 최종 수익률을 계산해 줍니다.

<br>

![image](https://github.com/user-attachments/assets/b9a126d6-a3fb-4384-b49a-eec50f0ec095)

![image](https://github.com/user-attachments/assets/e68f9c65-ae1d-4b11-8f5d-eeab97d524e7)

- 위와 같이 제공되는 차트를 통해 두 전략 중 어떤 것이 나은지 비교할 수 있고, 대략적인 추이도 확인할 수 있습니다.

<br>

![image](https://github.com/user-attachments/assets/cadc37ba-5b26-4563-a231-3689652b6b75)

- 위와 같이 정확한 매달 수익률과 총 자산은 모두 계산되어 `output/investment_simulation.xlsx`에 저장됩니다. 이를 통해 데이터를 더 자세히 분석할 수 있습니다.

## 생성되는 파일

- `output/nasdaq_index_comparison.png`: 나스닥 지수와 두 레버리지 투자 지수를 비교하는 차트
- `output/investment_vs_asset_value.png`: 총 투자 금액과 두 레버리지 자산 가치를 비교하는 차트
- `output/investment_simulation.xlsx`: 매월 투자 성과와 자산 변동을 기록한 엑셀 파일

## 코드 설명

이 시뮬레이터는 아래와 같은 단계를 통해 투자 백테스팅을 진행합니다:

1. **데이터 불러오기**: `nasdaq_daily_returns.xlsx` 파일에서 나스닥 일간 데이터를 불러옵니다.
2. **레버리지 설정**: 입력받은 레버리지 비율을 기반으로 투자 시뮬레이션을 진행합니다.
3. **매월 적립식 매수 시뮬레이션**: 각 월별로 일정 금액을 투자한 후, 레버리지 지수에 따라 자산 변동을 기록합니다.
4. **수익률 계산**: 투자 종료 시점에서 총 투자 금액과 자산 가치를 비교하여 최종 수익률을 계산합니다.
5. **결과 출력**: 최종 자산 금액과 수익률을 출력하고, 결과를 엑셀 파일로 저장합니다.

## 주요 기능 세부 설명

- **현금 보유와 레버리지 비교**: 현금 보유 시와 레버리지 ETF에 투자했을 때의 결과를 비교하여, 어떤 전략이 더 효율적이었는지 확인할 수 있습니다.
- **과거 시장 변동 반영**: 닷컴버블, 금융위기 등 과거 대규모 시장 변동성에 따른 투자 성과를 확인할 수 있습니다.
- **엑셀 파일 저장**: 시뮬레이션 결과는 `investment_simulation.xlsx` 파일로 저장되며, 이를 통해 투자 기간 동안의 자산 변동을 추적할 수 있습니다.

## 문의사항

프로젝트와 관련된 문의는 리포지토리의 이슈를 통해 남겨주세요!
